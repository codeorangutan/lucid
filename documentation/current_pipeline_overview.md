# Lucid App: Current Pipeline Overview (2025-05-03)

This document provides an up-to-date overview of the Lucid App's data pipeline, detailing each stage, the scripts/files used, and their roles. It is based on the latest project plan, documentation, and codebase structure.

---

## 1. PDF Parsing & Database Upload
- **Script:** `src/report_refactor/cognitive_importer.py`
- **Role:** Parses cognitive assessment PDFs and uploads structured patient data to the database.
- **Triggered by:** `src/run_pdf_to_report_pipeline.py` (Step 1)

## 2. JSON Generation from Database
- **Script:** `src/generate_report/generate_report_json.py`
- **Role:** Extracts patient data from the database and outputs it as a JSON file for downstream processing.
- **Triggered by:** `src/run_pdf_to_report_pipeline.py` (Step 2)

## 3. Executive Summary Generation
- **Script:** `src/report_engine/scaffold_executive_summary.py` (and/or `executive_summary.py`)
- **Role:** Processes the JSON data to build a comprehensive, styled HTML executive summary for the report.
- **Injected into:** HTML template during PDF rendering.

## 4. Report Rendering to PDF
- **Script:** `src/report_engine/report_pdf_playwright.py`
- **Role:** Injects the executive summary and patient data into the HTML template, applies CSS, and renders the final PDF using Playwright Chromium.
- **Template:** `templates/report_template_sum_valid.html`
- **Output:** PDF report and debug HTML.

## 5. Orchestration & Automation
- **Script:** `src/run_pdf_to_report_pipeline.py`
- **Role:** Main wrapper script that automates the pipeline (PDF → DB → JSON → PDF), handles logging, error capture, and supports test-driven development.
- **Log:** `run_pdf_to_report_pipeline.log`

---

## Additional/Supporting Stages

### Email Receiving & Parsing
- **Script:** `src/email_receiver.py`
- **Role:** Receives and parses incoming emails for new referrals or report notifications.

### Test Request Automation
- **Script:** `src/request_cns_test.py`
- **Role:** Automates web submission of test requests to external platforms.

### Report Notification Monitoring
- **Script:** `src/cns_vs_report_monitor.py`
- **Role:** Monitors for report completion notifications and downloads reports as needed.

### Orchestration & Scheduling
- **Script:** `src/orchestrator.py`
- **Role:** (Planned/Partial) Central controller for workflow, reminders, and status updates.

### Logging
- **Files:** `run_pdf_to_report_pipeline.log`, `report_generation.log`, etc.
- **Role:** Logs actions and errors for transparency and debugging.

### Utilities
- **Script:** utilities/delete_patient.py --patient_id <PATIENT_ID>
- **Role:** Deletes a patient from the database.
---

## Key Principles
- **Modularity:** Each stage is self-contained and testable.
- **DRY & ETC:** No duplication; easy to change or extend.
- **Logging & Error Handling:** Robust logging at every step.
- **TDD:** Pipeline supports test-driven development (dry-run mode, modular functions).

---

## How to Run the Pipeline

```bash
python src/run_pdf_to_report_pipeline.py --pdf <PDF_PATH> --patient_id <PATIENT_ID>
```
python src/run_pdf_to_report_pipeline.py --pdf inputs/40241.pdf --patient_id 40241
---
from /root
python src/report_engine/report_pdf_playwright.py --html templates/report_template_sum_valid.html --json json/40241.json --output output/40241_report.pdf
- See the script's help (`-h`) for advanced options (custom scripts, dry run, etc).

---

## Edge Cases
- What if we already have the patient in the database?
- 
---
## Further Ideas

Other independent goals:
1)	Have a utility that I can run that checks for email and request the report, then notifies me that it has been done. It should update the db with the request as well.
2)	Have a utility that downloads the report and refactors it automatically, then sends me the original report and the refactored example. It should update the db with the status of the report as well
3)	A check utility that verifies the data of these steps 

---
## For Further Reference
- See `/plans/ProjectPlan.md` for the original implementation plan.
- See `/documentation/report_generation_pipeline.md` for detailed report generation steps.
- See `/documentation/run_pdf_to_report_pipeline.md` for wrapper script documentation.

*Document generated by Cascade AI on 2025-05-03. For updates, rerun this overview or consult the latest codebase and documentation.*
